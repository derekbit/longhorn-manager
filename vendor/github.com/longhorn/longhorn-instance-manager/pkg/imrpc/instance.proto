syntax="proto3";

package imrpc;

import "google/protobuf/empty.proto";
import "imrpc.proto";

service InstanceService {
    rpc InstanceCreate(InstanceCreateRequest) returns (InstanceResponse) {}
	rpc InstanceDelete(InstanceDeleteRequest) returns (InstanceResponse) {}
	rpc InstanceGet(InstanceGetRequest) returns (InstanceResponse) {}
	rpc InstanceList(google.protobuf.Empty) returns (InstanceListResponse) {}
	rpc InstanceLog(InstanceLogRequest) returns (stream LogResponse) {}
	rpc InstanceWatch(google.protobuf.Empty) returns (stream InstanceResponse) {}
	rpc InstanceReplace(InstanceReplaceRequest) returns (InstanceResponse) {}

	rpc VersionGet(google.protobuf.Empty) returns(VersionResponse);
}

message ProcessSpecific {
	string binary = 1;
	repeated string args = 2;
}

message SpdkSpecific {
    map<string, string> replica_address_map = 1;
    string frontend = 2;
	string disk_uuid = 3;
}

message InstanceSpec {
	string name = 1;
	string type = 2;
	string backend_store_driver = 3;

	int64 size = 4;

	int32 port_count = 5;
	repeated string port_args = 6;

	ProcessSpecific process_specific = 7;
	SpdkSpecific spdk_specific = 8;
}

message InstanceStatus {
	string state = 1;
	string error_msg = 2;
	int32 port_start = 3;
	int32 port_end = 4;
}

message InstanceCreateRequest {
	InstanceSpec spec = 1;
}

message InstanceDeleteRequest {
	string name = 1;
	string type = 2;
	string backend_store_driver = 3;

	string disk_uuid = 4;
}

message InstanceGetRequest {
	string name = 1;
	string type = 2;
	string backend_store_driver = 3;

	string disk_uuid = 4;
}

message InstanceResponse {
	InstanceSpec spec = 1;
	InstanceStatus status = 2;
	bool deleted = 3;
}

message InstanceListResponse{
	map<string, InstanceResponse> instances = 1;
}

message InstanceLogRequest {
	string name = 1;
	string type = 2;
	string backend_store_driver = 3;
}

message InstanceReplaceRequest {
	InstanceSpec spec = 1;
	string terminate_signal = 2;
}
